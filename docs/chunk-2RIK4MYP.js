import{f as a,o as c,r as n,y as i}from"./chunk-IV62SXZ6.js";var s=class e{constructor(t){this.document=t;this.updateCartCount()}cartCountSubject=new a(0);cartCount$=this.cartCountSubject.asObservable();CART_KEY="bookstore_cart";getCart(){try{if(this.isLocalStorageAvailable()){let r=localStorage.getItem(this.CART_KEY);if(r){let o=JSON.parse(r);return console.log("Cart loaded from localStorage:",o),Array.isArray(o)?o:[]}}let t=this.document.cookie.match(new RegExp("(^| )cart=([^;]+)"));if(t){let r=JSON.parse(decodeURIComponent(t[2]));return console.log("Cart loaded from cookies:",r),Array.isArray(r)?r:[]}}catch(t){console.error("Error loading cart:",t)}return[]}setCart(t){try{if(!Array.isArray(t)){console.error("Invalid cart data:",t);return}this.isLocalStorageAvailable()&&(localStorage.setItem(this.CART_KEY,JSON.stringify(t)),console.log("Cart saved to localStorage:",t));let r=new Date(Date.now()+7*24*60*60*1e3).toUTCString();this.document.cookie=`cart=${encodeURIComponent(JSON.stringify(t))}; expires=${r}; path=/; SameSite=Lax`,this.updateCartCount()}catch(r){console.error("Error saving cart:",r)}}updateCartCount(){try{let r=this.getCart().reduce((o,l)=>o+(l.quantity||0),0);this.cartCountSubject.next(r),console.log("Cart count updated:",r)}catch(t){console.error("Error updating cart count:",t),this.cartCountSubject.next(0)}}isLocalStorageAvailable(){try{let t="__localStorage_test__";return localStorage.setItem(t,t),localStorage.removeItem(t),!0}catch{return!1}}clearCart(){try{this.isLocalStorageAvailable()&&localStorage.removeItem(this.CART_KEY),this.document.cookie="cart=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",this.updateCartCount(),console.log("Cart cleared")}catch(t){console.error("Error clearing cart:",t)}}getCartDebugInfo(){let t=this.isLocalStorageAvailable(),r=t?localStorage.getItem(this.CART_KEY):"Not available",o=this.document.cookie.match(new RegExp("(^| )cart=([^;]+)"))?.[2]||"Not found";return{localStorageAvailable:t,localStorageData:r,cookieData:o,currentCart:this.getCart(),cartCount:this.cartCountSubject.value}}static \u0275fac=function(r){return new(r||e)(n(i))};static \u0275prov=c({token:e,factory:e.\u0275fac,providedIn:"root"})};export{s as a};
